# Team Retrospective - Epic 001: Foundation - PoB Calculation Engine Integration

**Date:** October 27, 2025
**Facilitator:** Bob (Scrum Master)
**Participants:** Sarah (PO), Amelia (Dev), Winston (Architect), Murat (TEA), Mary (Analyst), John (PM)

---

## Epic 001 Summary

### Delivery Metrics
- **Completed:** 8/8 stories (100%)
- **Story Points:** 26 planned (all delivered)
- **Duration:** ~17 days (Oct 11 - Oct 27, 2025)
- **Average velocity:** ~1.5 story points/day

### Quality and Technical
- **Blockers encountered:** 3 major (all resolved)
  - Story 1.5: PoB engine integration complexity
  - Story 1.6: Calculation parity challenges (achieved 0% error!)
  - Story 1.8: Performance target revision (1s â†’ 2s, approved)
- **Technical debt items:** 67 logged (16 High/Critical priority)
- **Test coverage:** Comprehensive (unit, integration, performance tests)
- **Production incidents:** 0 (local MVP)

### Business Outcomes
- **Goals achieved:** 6/6 epic success criteria met
  - âœ… Parse 100 sample PoB codes (100% success rate)
  - âœ… <100ms per calculation (achieved 2ms)
  - âœ… Batch 1000 in <2s (revised from 1s, approved)
  - âœ… Â±0.1% accuracy (achieved 0% error on primary stats)
  - âœ… <100MB memory (45MB actual)
  - âœ… Zero Lua crashes

---

## Part 1: Epic Review - What We Learned

### Sarah (Product Owner)

**What Went Well:**
- All 8 stories achieved full acceptance criteria compliance
- Course correction process on Story 1.8 worked smoothly - identified performance gap early, evaluated options, obtained stakeholder approval for 2s target
- Story 1.6 achieved remarkable 0% error on primary stats (Life, Mana, Evasion, DPS, Resistances)
- Comprehensive story documentation enabled clear validation

**What Could Improve:**
- 67 backlog items accumulated (16 High/Critical) - need better real-time grooming
- Some stories (1.5, 1.6) had completion status inconsistencies requiring post-review fixes
- Technical debt documentation scattered across stories - need centralized Epic-level tracking

**Lessons Learned:**
- Course correction framework proved essential - rigid adherence to original 1s target would have been wasteful
- Parity testing (Story 1.6) was absolutely critical - caught formula errors early
- Story status updates need more discipline - "Done" should mean truly complete

### Amelia (Developer Agent)

**What Went Well:**
- Lupa integration cleaner than expected - MinimalCalc.lua breakthrough in Story 1.4 was key
- Test-driven approach paid off - comprehensive test suite caught issues before manual testing
- Story 1.8 performance optimization achieved 8x improvement (16.3s â†’ 2.0s)
- Pythonâ†”Lua bridge stable and reusable for Epic 2

**What Could Improve:**
- Story 1.5 had incomplete PoB engine integration initially - fake fallback values masked problems
- pytest + LuaJIT cleanup crash on Windows required workaround (pytest-xdist)
- Some acceptance criteria ambiguous (Story 1.6: "10 test builds" vs "GUI parity")
- Performance profiling should have happened earlier (Story 1.8)

**Lessons Learned:**
- Never use fallback/fake values in tests - they hide real integration issues
- Profile early, profile often - Story 1.8 would have been easier with baseline from Story 1.5
- Windows-specific issues need documentation (LuaJIT SEH exceptions are cosmetic but scary)
- Pre-compilation and object reuse = massive wins (69.5% overhead eliminated)

### Winston (Architect)

**What Went Well:**
- Layered architecture (Parsers â†’ Calculator â†’ Models) held up well across 8 stories
- Thread-local LuaRuntime pattern worked perfectly - no concurrency issues
- Module boundaries clean - no circular dependencies introduced
- MinimalCalc.lua abstraction layer brilliant decision - isolated PoB complexity

**What Could Improve:**
- PassiveTreeGraph API needs refinement before Epic 2 - current adjacency list may not be optimal for neighbor generation
- Error handling inconsistent across modules - some use exceptions, some return None
- Logging strategy needs standardization - debug levels vary wildly
- Memory management reactive rather than proactive - should have monitoring from Story 1.1

**Lessons Learned:**
- Abstraction layers save the day - MinimalCalc.lua prevented PoB dependency hell
- Performance architecture matters from day 1 - pre-compilation should have been baseline, not optimization
- Thread-local pattern essential for stateful resources (LuaRuntime, passive tree)
- Technical debt compounds fast - 67 items in 8 stories means ~8 per story average

### Murat (Master Test Architect)

**What Went Well:**
- Test pyramid well-balanced - unit (60%), integration (30%), performance (10%)
- pytest-benchmark excellent choice - caught Story 1.8 performance issues immediately
- Parity testing framework (Story 1.6) robust - 0% error achievement proves test quality
- Fixtures well-organized - tests/fixtures/parity_builds reusable

**What Could Improve:**
- Performance tests added too late (Story 1.8) - should have been in Story 1.5
- GUI parity tests incomplete - only synthetic builds, no real PoB GUI exports
- Test execution time growing - 9733 total story lines, integration tests slow
- Windows-specific test issues need CI/CD strategy - can't rely on manual pytest -n 1

**Lessons Learned:**
- Performance testing = acceptance criteria - can't defer to "later optimization"
- Real-world fixtures > synthetic - Story 1.6 synthetic builds missed formula edge cases
- Platform-specific quirks need documented workarounds AND CI alternatives
- Test quality directly correlates to delivery confidence - Story 1.6 rebuilt entire test suite to get parity right

### Mary (Business Analyst)

**What Went Well:**
- Requirements from PRD and Tech Spec crystal clear - minimal ambiguity
- Dual budget constraint feature well-documented (DUAL-BUDGET-FEATURE-SUMMARY.md)
- Acceptance criteria mostly testable and unambiguous
- Stakeholder engagement strong on Story 1.8 course correction

**What Could Improve:**
- Epic success criteria (tech-spec-epic-1.md:996) not tracked formally during execution
- Some ACs ambiguous (Story 1.6: "10 test builds" interpretation varied)
- User journey validation missing - no end-to-end workflow tested yet
- Backlog severity/priority classification inconsistent (High vs Critical usage)

**Lessons Learned:**
- Course correction needs formal process - Story 1.8 handled well but was ad-hoc
- Epic-level success criteria need milestone tracking - shouldn't wait for epic completion to verify
- Requirements traceability matrix would help (AC â†’ Test â†’ Code)
- Technical specs excellent, but need living document maintenance (POB_VERSION.txt, etc.)

### John (Product Manager)

**What Went Well:**
- Epic 1 delivered all business value prerequisites for Epic 2 - zero scope descope needed
- 2-month MVP timeline still achievable - Epic 1 took ~2.5 weeks, on track for 3 epic delivery
- Performance targets enable competitive advantage - 2ms per calculation faster than competition
- Technical foundation solid - can confidently sell Epic 2 optimization algorithm

**What Could Improve:**
- No user validation yet - local MVP means no real user feedback loop
- Competitive analysis missing - are we faster than PoB GUI? Yes (50-200ms vs 2ms)
- Market requirements evolving - PoE 2 changes weekly, need PoB version update strategy
- Technical debt runway unclear - 67 items could delay Epic 3 UI work

**Lessons Learned:**
- Course correction = agile excellence - rigid commitment to unachievable targets wastes resources
- Performance specs need competitive context - "1000 in 1s" meaningless without benchmark comparison
- Technical debt is product risk - 16 High/Critical items may block Epic 2 stories
- Local MVP smart choice - Epic 1 complexity would have multiplied with deployment concerns

---

## Part 2: Next Epic Preparation

### Epic 002 Preview: Core Optimization Engine

**Dependencies on Epic 001:**
- âœ… PoB calculation engine (calculate_build_stats API)
- âœ… Passive tree graph structure (PassiveTreeGraph)
- âœ… BuildData/BuildStats models
- âœ… Performance foundation (2ms per calculation enables 5-10s optimizations)

**Preparation Needed:**
- Hill climbing algorithm implementation (Story 2.1)
- Neighbor generation logic (Story 2.2)
- Dual budget constraint system (Stories 2.3-2.5)
- Metric selection framework (Story 2.6)
- Convergence detection (Story 2.7)
- Progress tracking infrastructure (Story 2.8)

**Technical Prerequisites:**
- âœ… All Epic 1 APIs stable and tested
- âš ï¸ Review backlog for blocking issues (16 High/Critical items)
- ðŸ“‹ Architecture review for Epic 2 design patterns
- ðŸ§ª Performance baseline established for optimization algorithm

### Forward-Looking Analysis by Team

#### Dependencies Identified

**Ready:**
- Epic 1 APIs stable: `calculate_build_stats()`, `parse_pob_code()`, `PassiveTreeGraph`
- Performance foundation: 2ms per calculation enables fast iteration
- Test infrastructure reusable

**Concerns:**
- PassiveTreeGraph.is_connected() performance - Story 2.2 may call this 100,000+ times
- BuildData mutation safety - Epic 2 will modify passive_nodes sets heavily
- PoE 2 passive points formula needs validation (backlog item from Story 1.1)

#### Architecture Preparation Needs (Winston)

**New Module Required:**
```
src/optimizer/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ hill_climbing.py        # Story 2.1
â”œâ”€â”€ neighbor_generator.py   # Story 2.2
â”œâ”€â”€ budget_tracker.py       # Story 2.4
â”œâ”€â”€ metrics.py              # Story 2.6
â”œâ”€â”€ convergence.py          # Story 2.7
â””â”€â”€ progress.py             # Story 2.8
```

**Critical Performance Concern:**
Story 2.2 will call PassiveTreeGraph pathfinding potentially 100,000+ times per optimization. Current O(n) BFS implementation may be too slow. Need to profile and potentially optimize with:
- Option A: Memoization cache for reachable nodes
- Option B: Union-find data structure
- Option C: Pre-computed distance matrix

**Estimated Impact:** Could be difference between 10-second vs 5-minute optimizations

#### Test Strategy (Murat)

**Test Corpus Needs:**
- 20-30 diverse builds for Epic 2 validation
- **NEW INFO:** PoE 2 is LIVE - can use real Maxroll builds!
- Alec can pull builds from Maxroll and create custom test builds
- Need "already optimal" builds for convergence testing (Story 2.7)
- Need "known inefficient" builds with clear improvement opportunities

**Testing Approach:**
- Mock calculator for fast unit tests
- Limit integration tests to 5-10 representative builds
- Accept multiple valid solutions (compare improvement %, not exact nodes)
- Performance benchmarks required from Story 2.1 onward

#### Requirements Clarification (Mary)

**Gaps Identified:**
- Story 2.8 (Progress Tracking) mentions "UI updates" but Epic 3 is UI epic - need scope clarity
- "5-15% median improvement" requires 20+ test build corpus to measure
- Edge case: "No improvement found" needs acceptance criteria
- Dual budget UX assumption needs validation

**Success Criteria Questions:**
- What if only 3% improvement achieved? Is that acceptable?
- 5-minute optimization timeout acceptable UX?
- How do we prove improvements are real, not algorithm artifacts?

#### Market Context (John)

**UPDATED:** PoE 2 is live! Market urgency HIGH.

**Test Corpus Strategy:**
- Source 1: Maxroll PoE 2 build guides (10-15 builds) - HIGH QUALITY
- Source 2: Alec's personal builds (5-10 builds) - CUSTOM INEFFICIENCIES
- Source 3: Synthetic optimal builds (3-5 builds) - CONVERGENCE TESTING

**Competitive Position:**
- PoB has basic "find path between nodes" - we're doing FULL tree optimization
- No known competitors with hill climbing for PoE 2
- First-mover advantage opportunity

**Risk:** 8%+ median improvement may be harder than expected if builds are already efficient

---

## Action Items

### Process Improvements

1. **Story Completion Discipline** (Owner: Sarah/Bob, By: Before Epic 2 Story 1)
   - Define strict "Definition of Done" checklist
   - Story status "Done" requires: All ACs met, tests passing, docs complete, backlog logged
   - No "done with notes" status

2. **Technical Debt Grooming** (Owner: Sarah + Team, By: Weekly during Epic 2)
   - Weekly 30-minute backlog review
   - Triage new items immediately (severity, owner, epic linkage)
   - Centralized Epic-level tracking

3. **Performance Testing Earlier** (Owner: Murat, By: Epic 2 Story 2.1)
   - Add performance AC to EVERY story with calculation/algorithm work
   - Baseline â†’ implement â†’ measure â†’ optimize pattern

### Technical Debt Priority

**High Priority (Preparation Sprint):**

1. **Validate PoE 2 passive points formula** (Owner: Amelia, Est: 2-3 hours)
   - Blocks Story 2.3
   - PoE 2 is live - can verify in-game!
   - Update BuildData.unallocated_points property

2. **Triage 16 High/Critical backlog items** (Owner: Sarah + Team, Est: 2 hours)
   - Identify Epic 2 blockers
   - Defer non-blockers to post-MVP

3. **Document pytest-LuaJIT workaround** (Owner: Amelia, Status: âœ… DONE)
   - Already completed per backlog line 64

### Documentation

1. **README.md Epic 1 Update** (Owner: Amelia, By: End of week, Est: 30 min)
   - Mark Epic 1 complete
   - Add achievements summary
   - Update roadmap

2. **Epic 1 Lessons Learned** (Owner: Bob, By: After retro, Est: 1 hour)
   - This document!

### Team Agreements

- **Performance = Acceptance Criteria** - not optional, not deferred
- **Real-world test fixtures > Synthetic** - prefer Maxroll builds
- **Course correction is strength** - adapt when data shows target unrealistic
- **Technical debt is product risk** - address High/Critical promptly

---

## Preparation Sprint (Before Epic 2)

**Duration:** 2-3 days
**Goal:** De-risk Epic 2 start, create test corpus, address critical prerequisites

### Technical Setup

**1. Profile PassiveTreeGraph Performance** (Owner: Amelia + Winston, Est: 4-6 hours, Priority: HIGH)
- Profile is_connected() with 1000-node allocated set
- Target: <0.5ms per pathfinding check
- If too slow, implement optimization (memoization recommended)
- **Critical:** Story 2.2 calls this 100,000+ times

**2. Create src/optimizer/ Module Architecture** (Owner: Winston, Est: 2 hours)
- Design Epic 2 module structure
- Define interface contracts
- Document in docs/architecture/epic-2-optimizer-design.md

**3. Validate PoE 2 Passive Points Formula** (Owner: Amelia, Est: 2-3 hours)
- Test in-game at levels 1, 40, 85, 100
- Update BuildData.unallocated_points
- Add unit tests

### Test Build Corpus Creation

**4. Pull Maxroll Builds for Test Corpus** (Owner: Alec + Amelia, Est: 4-6 hours, Priority: HIGH)
- **Goal:** 20-30 diverse builds
- **Source 1:** Maxroll guides (10-15 builds) - variety of classes/levels/archetypes
- **Source 2:** Alec's personal builds (5-10 builds) - include "known inefficient"
- **Source 3:** Synthetic optimal builds (3-5 builds) - for convergence testing
- **Deliverable:** tests/fixtures/optimization_builds/corpus.json with metadata:
  - build_id, source, url, pob_code, baseline_dps, baseline_ehp, level, allocated_points, notes

**5. Establish Epic 2 Success Baseline** (Owner: Murat, Est: 2 hours, Depends: Task 4)
- Run Epic 1 calculator on all test builds
- Record baseline stats
- Calculate corpus statistics
- Save to tests/fixtures/optimization_builds/baseline_stats.json
- **Defines:** "8%+ median improvement" target

### Knowledge Development

**6. Research Hill Climbing Algorithm Patterns** (Owner: Amelia + Winston, Est: 3-4 hours)
- Review hill climbing literature
- Research PoE-specific optimization approaches
- Identify pruning strategies for neighbor generation
- Document in docs/research/hill-climbing-strategy.md
- **Deliverable:** Pseudocode for Stories 2.1-2.2

**7. Define Story 2.8 Scope** (Owner: Sarah + Winston, Est: 1 hour)
- Clarify deliverable: API-only or API + console output?
- **Recommendation:** API + basic console (helps debug, minimal effort)
- Update Story 2.8 acceptance criteria

### Cleanup/Refactoring

**8. Backlog Triage and Cleanup** (Owner: Sarah + Team, Est: 2-3 hours)
- Review 67 items, focus on 16 High/Critical
- Tag with Epic number (Epic 1 debt, Epic 2, Epic 3, Post-MVP)
- Update backlog.md with decisions

**9. Update Tech Spec for Course Corrections** (Owner: Winston, Est: 30 min)
- Update tech-spec-epic-1.md:980 to reflect approved 2s target
- Add "Course Corrections" section
- Document rationale

**10. Create Story Context for Epic 2** (Owner: Bob, Est: 4-6 hours, Optional)
- Assemble Story Context XML for Stories 2.1-2.8
- Include: HLA, PRD, Tech Spec, Epics, relevant Epic 1 code
- Can use /story-context workflow

**Total Effort:** ~25-35 hours (3-4 days)

### Critical Path

**Blockers (Must Complete):**
1. âœ… Validate PoE 2 passive points formula (Task 3) â†’ Story 2.3
2. âœ… Create test build corpus (Task 4) â†’ Epic 2 validation
3. âœ… Establish baseline stats (Task 5) â†’ "8% median improvement" target

**High Priority (Should Complete):**
4. Profile PassiveTreeGraph (Task 1) â†’ Story 2.2 performance
5. Define optimizer architecture (Task 2) â†’ Prevents rework
6. Backlog triage (Task 8) â†’ Clear runway

### Dependencies Timeline

```
Day 1 (Prep Sprint Start):
â”œâ”€ Task 3: Validate passive points formula (2-3 hrs)
â”œâ”€ Task 1: Profile PassiveTreeGraph (4-6 hrs parallel)
â”œâ”€ Task 2: Design optimizer architecture (2 hrs parallel)
â””â”€ Task 4: Pull Maxroll builds START

Day 2:
â”œâ”€ Task 4: Complete test corpus
â”œâ”€ Task 5: Establish baseline stats (after Task 4)
â”œâ”€ Task 6: Research hill climbing (parallel)
â””â”€ Task 8: Backlog triage (parallel)

Day 3:
â”œâ”€ Task 7: Define Story 2.8 scope (1 hr)
â”œâ”€ Task 9: Update tech spec (30 min)
â”œâ”€ Task 10: Story Context assembly (optional)
â””â”€ All tasks complete â†’ Epic 2 Story 2.1 READY
```

---

## Key Takeaways

1. **Performance foundation solid:** 2ms per calculation enables Epic 2 optimization algorithm
2. **Parity achievement exceptional:** 0% error on primary stats builds trust in calculation engine
3. **Course correction strength:** Story 1.8 target revision (1s â†’ 2s) was right call - pragmatic over dogmatic
4. **Technical debt requires discipline:** 67 items in 8 stories shows need for continuous grooming
5. **Real-world testing critical:** Maxroll builds will provide better validation than synthetic fixtures
6. **PoE 2 is LIVE:** Market urgency high - users need optimization tools NOW

---

## Next Steps

**Immediate Actions:**
1. âœ… Save this retrospective (DONE - you're reading it!)
2. Begin Preparation Sprint (Est: 3-4 days)
3. Complete Critical Path items (Tasks 3, 4, 5)
4. Review completion in next standup

**Epic 2 Launch Readiness:**
- **When:** After Preparation Sprint complete (3-4 days)
- **Prerequisites:** Critical Path complete, test corpus ready, architecture defined
- **First Story:** Story 2.1 - Implement Hill Climbing Core Algorithm

---

**Scrum Master Closing:**

"Excellent work team! Epic 001 was a strong foundation sprint. The parity achievement and performance optimization give us confidence for Epic 2. The fact that PoE 2 is already live increases market urgency - let's use the Preparation Sprint wisely to set up Epic 2 for success. Alec, having access to Maxroll builds is a huge advantage - that test corpus will be invaluable for validation.

See you at sprint planning once prep work is done!"

â€” Bob (Scrum Master)
